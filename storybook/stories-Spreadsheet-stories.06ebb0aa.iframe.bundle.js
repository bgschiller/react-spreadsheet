"use strict";(self.webpackChunkreact_spreadsheet=self.webpackChunkreact_spreadsheet||[]).push([[417],{"./src/stories/Spreadsheet.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:()=>Basic,Controlled:()=>Controlled,CustomColumnLabels:()=>CustomColumnLabels,CustomRowLabels:()=>CustomRowLabels,DarkMode:()=>DarkMode,Filter:()=>Filter,HideIndicators:()=>HideIndicators,RangeCell:()=>RangeCell,Readonly:()=>Readonly,WithAsyncCellData:()=>WithAsyncCellData,WithCornerIndicator:()=>WithCornerIndicator,WithCustomCell:()=>WithCustomCell,WithSelectCell:()=>WithSelectCell,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Spreadsheet_stories});var react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames);function actions_setCellData(active,data){return{type:"SET_CELL_DATA",payload:{active,data}}}function createEmpty(rows,columns){const matrix=Array(rows);for(let i=0;i<rows;i++)matrix[i]=Array(columns);return matrix}function get(point,matrix){const columns=matrix[point.row];if(void 0!==columns)return columns[point.column]}function slice(startPoint,endPoint,matrix){const sliced=[],columns=endPoint.column-startPoint.column;for(let row=startPoint.row;row<=endPoint.row;row++){const slicedRow=row-startPoint.row;sliced[slicedRow]=sliced[slicedRow]||Array(columns);for(let column=startPoint.column;column<=endPoint.column;column++)sliced[slicedRow][column-startPoint.column]=get({row,column},matrix)}return sliced}function set(point,value,matrix){const nextMatrix=[...matrix],firstRow=matrix[0],nextFirstRow=firstRow?[...firstRow]:[];nextFirstRow.length-1<point.column&&(nextFirstRow[point.column]=void 0,nextMatrix[0]=nextFirstRow);const nextRow=matrix[point.row]?[...matrix[point.row]]:[];return nextRow[point.column]=value,nextMatrix[point.row]=nextRow,nextMatrix}function mutableSet(point,value,matrix){let firstRow=matrix[0];firstRow||(firstRow=[],matrix[0]=firstRow),point.row in matrix||(matrix[point.row]=[]),point.column in firstRow||(firstRow[point.column]=void 0),matrix[point.row][point.column]=value}function*matrix_entries(matrix){for(const[row,values]of matrix.entries())for(const[column,value]of values.entries()){const point={row,column};yield[point,value]}}function has(point,matrix){const firstRow=matrix[0];return firstRow&&point.row>=0&&point.column>=0&&Number.isInteger(point.row)&&Number.isInteger(point.column)&&point.column<firstRow.length&&point.row<matrix.length}function getSize(matrix){return{columns:getColumnsCount(matrix),rows:getRowsCount(matrix)}}function getRowsCount(matrix){return matrix.length}function getColumnsCount(matrix){const firstRow=matrix[0];return firstRow?firstRow.length:0}function matrix_maxPoint(matrix){const size=getSize(matrix);return{row:size.rows-1,column:size.columns-1}}function is(value){return"number"==typeof value?.row&&"number"==typeof value?.column}const ORIGIN={row:0,column:0};function create(source,target){return{start:{row:Math.min(source.row,target.row),column:Math.min(source.column,target.column)},end:{row:Math.max(source.row,target.row),column:Math.max(source.column,target.column)}}}function*iterate(range){for(let row=range.start.row;row<=range.end.row;row++)for(let column=range.start.column;column<=range.end.column;column++)yield{row,column}}function point_range_has(range,point){return point.row>=range.start.row&&point.column>=range.start.column&&point.row<=range.end.row&&point.column<=range.end.column}function point_range_is(value){return is(value?.start)&&is(value?.end)}let Direction=function(Direction){return Direction.Left="Left",Direction.Right="Right",Direction.Top="Top",Direction.Bottom="Bottom",Direction}({}),EntireType=function(EntireType){return EntireType.Row="row",EntireType.Column="column",EntireType.Table="table",EntireType}({});function isEntireTable(selection){return null!==selection&&"type"in selection&&selection.type===EntireType.Table}function createEntireRows(start,end){if(!isIndex(start))throw new InvalidIndexError("start");if(!isIndex(end))throw new InvalidIndexError("end");return{type:EntireType.Row,start:Math.min(start,end),end:Math.max(start,end)}}function createEntireColumns(start,end){if(!isIndex(start))throw new InvalidIndexError("start");if(!isIndex(end))throw new InvalidIndexError("end");return{type:EntireType.Column,start:Math.min(start,end),end:Math.max(start,end)}}function toRange(selection,data){if(null===selection)return null;if(point_range_is(selection))return selection;switch(selection.type){case EntireType.Row:{const max=matrix_maxPoint(data);return create({row:selection.start,column:0},{row:selection.end,column:max.column})}case EntireType.Column:{const max=matrix_maxPoint(data);return create({row:0,column:selection.start},{row:max.row,column:selection.end})}case EntireType.Table:return getMatrixRange(data)}}function hasEntireRow(selection,row){return function isEntireRows(selection){return null!==selection&&"type"in selection&&selection.type===EntireType.Row}(selection)&&row>=selection.start&&row<=selection.end}function hasEntireColumn(selection,column){return function isEntireColumns(selection){return null!==selection&&"type"in selection&&selection.type===EntireType.Column}(selection)&&column>=selection.start&&column<=selection.end}function normalizeRange(range,data){return function mask(masked,mask){return create({row:mask.start.row>masked.start.row?mask.start.row:masked.start.row,column:mask.start.column>masked.start.column?mask.start.column:masked.start.column},{row:mask.end.row<masked.end.row?mask.end.row:masked.end.row,column:mask.end.column<masked.end.column?mask.end.column:masked.end.column})}(range,getMatrixRange(data))}function normalizeEntireRows(selection,data){const count=getRowsCount(data);return createEntireRows(Math.max(selection.start,0),Math.min(selection.end,count-1))}function normalizeEntireColumns(selection,data){const count=getColumnsCount(data);return createEntireColumns(Math.max(selection.start,0),Math.min(selection.end,count-1))}function getPoints(selection,data){const range=toRange(selection,data);return range?Array.from(iterate(range)):[]}function getSelectionFromMatrix(selection,data){const range=toRange(selection,data);return range?function getRangeFromMatrix(range,matrix){return slice(range.start,range.end,matrix)}(range,data):[]}function modifyEdge(selection,active,data,edge){if(active&&selection){if(point_range_is(selection))return function modifyRangeEdge(range,active,data,edge){const field=edge===Direction.Left||edge===Direction.Right?"column":"row",key=edge===Direction.Left||edge===Direction.Top?"start":"end",delta="start"===key?-1:1,edgeOffsets=point_range_has(range,{...active,[field]:active[field]+-1*delta}),keyToModify=edgeOffsets?"start"===key?"end":"start":key,nextRange={...range,[keyToModify]:{...range[keyToModify],[field]:range[keyToModify][field]+delta}};return normalizeRange(nextRange,data)}(selection,active,data,edge);switch(selection.type){case EntireType.Row:return function modifyEntireRowsEdge(selection,active,data,edge){if(edge===Direction.Left||edge===Direction.Right)return selection;const delta=edge===Direction.Top?-1:1,property=edge===Direction.Top?"start":"end",oppositeProperty="start"===property?"end":"start";let nextSelection;nextSelection=(edge===Direction.Top?selection.end>active.row:selection.start<active.row)?{...selection,[oppositeProperty]:selection[oppositeProperty]+delta}:{...selection,[property]:selection[property]+delta};return normalizeEntireRows(nextSelection,data)}(selection,active,data,edge);case EntireType.Column:return function modifyEntireColumnsEdge(selection,active,data,edge){if(edge===Direction.Top||edge===Direction.Bottom)return selection;const delta=edge===Direction.Left?-1:1,property=edge===Direction.Left?"start":"end",oppositeProperty="start"===property?"end":"start";let nextSelection;nextSelection=(edge===Direction.Left?selection.end>active.column:selection.start<active.column)?{...selection,[oppositeProperty]:selection[oppositeProperty]+delta}:{...selection,[property]:selection[property]+delta};return normalizeEntireColumns(nextSelection,data)}(selection,active,data,edge)}}return selection}function getMatrixRange(data){const maxPoint=matrix_maxPoint(data);return create(ORIGIN,maxPoint)}function isIndex(value){return Number.isInteger(value)&&value>=0}class InvalidIndexError extends Error{constructor(name){super(`${name} is not a valid index. It must be 0 or a positive integer`)}}function point_map_set(point,value,map){return{...map,[point.row]:{...map[point.row],[point.column]:value}}}function point_map_unset({row,column},map){if(!(row in map)||!(column in map[row]))return map;const{[String(row)]:{[String(column)]:_,...nextRow},...nextMap}=map;return 0===Object.keys(nextRow).length?nextMap:{...nextMap,[row]:nextRow}}function point_map_get(point,map){return map[point.row]&&map[point.row][point.column]}function point_map_has(point,map){return point.row in map&&point.column in map[point.row]}const EMPTY={};function from(pairs){return pairs.reduce(((acc,[point,value])=>point_map_set(point,value,acc)),EMPTY)}function reduce(func,map,initialValue){let acc=initialValue;const _map_keys=Object.keys(map);for(let i=0;i<_map_keys.length;i++){const row=Number(_map_keys[i]),columns=map[row],_columns_keys=Object.keys(columns);for(let j=0;j<_columns_keys.length;j++){const column=Number(_columns_keys[j]);acc=func(acc,columns[column],{row,column})}}return acc}function*entries(map){for(const row in map)for(const column in map[row])yield[{row:Number(row),column:Number(column)},map[row][column]]}const point_set_has=(set,point)=>point_map_has(point,set),point_set_size=set=>function point_map_size(map){let acc=0;const _map_keys=Object.keys(map);for(let i=0;i<_map_keys.length;i++){const columns=map[Number(_map_keys[i])];acc+=Object.keys(columns).length}return acc}(set);const minKey=object=>Math.min(...Object.keys(object));function min(set){const row=minKey(set);return{row,column:minKey(set[row])}}const maxKey=object=>Math.max(...Object.keys(object));function point_set_from(points){return points.reduce(((acc,point)=>point_map_set(point,!0,acc)),from([]))}function point_set_toRange(set){const start=min(set),end=function max(set){const row=maxKey(set);return{row,column:maxKey(set[row])}}(set);return create(start,end)}function add(point,set){return point_map_set(point,!0,set)}function remove(point,set){return point_map_unset(point,set)}function point_set_toArray(set){return reduce(((acc,value,point)=>[...acc,point]),set,[])}function subtract(toSubtract,set){let newSet=set;for(const point of point_set_toArray(toSubtract))newSet=remove(point,newSet);return newSet}function*point_set_entries(set){for(const[point]of entries(set))yield point}const FOCUS_WITHIN_SELECTOR=":focus-within";function range(end,start=0,step=1){const array=[];if(-1===Math.sign(end-start)){for(let element=start;element>end;element-=step)array.push(element);return array}for(let element=start;element<end;element+=step)array.push(element);return array}function isActive(active,point){return Boolean(active&&function isEqual(source,target){return source.column===target.column&&source.row===target.row}(point,active))}function getOffsetRect(element){return{width:element.offsetWidth,height:element.offsetHeight,left:element.offsetLeft,top:element.offsetTop}}function getCellDimensions(point,rowDimensions,columnDimensions){const cellRowDimensions=rowDimensions&&rowDimensions[point.row],cellColumnDimensions=columnDimensions&&columnDimensions[point.column];return cellRowDimensions&&cellColumnDimensions&&{...cellRowDimensions,...cellColumnDimensions}}function getRangeDimensions(rowDimensions,columnDimensions,range){const startDimensions=getCellDimensions(range.start,rowDimensions,columnDimensions),endDimensions=getCellDimensions(range.end,rowDimensions,columnDimensions);return startDimensions&&endDimensions&&{width:endDimensions.left+endDimensions.width-startDimensions.left,height:endDimensions.top+endDimensions.height-startDimensions.top,top:startDimensions.top,left:startDimensions.left}}function getCSV(data){return function join(matrix,horizontalSeparator="\t",verticalSeparator="\n"){let joined="";const{rows,columns}=getSize(matrix);for(let row=0;row<rows;row++){row&&(joined+=verticalSeparator);for(let column=0;column<columns;column++)column&&(joined+=horizontalSeparator),matrix[row]&&column in matrix[row]&&(joined+=String(matrix[row][column]))}return joined}(function map(func,matrix){const newMatrix=[];for(const[point,value]of matrix_entries(matrix))mutableSet(point,func(value,point),newMatrix);return newMatrix}((cell=>cell?.value||""),data))}function convertPointMapToPointSet(map){return function point_map_map(func,map){return reduce(((acc,value,point)=>point_map_set(point,func(value),acc)),map,from([]))}((()=>!0),map)}function getCopiedRange(copied,hasPasted){if(hasPasted||function isEmpty(map){return 0===Object.keys(map).length}(copied))return null;return point_set_toRange(convertPointMapToPointSet(copied))}function shouldHandleClipboardEvent(root,mode){return null!==root&&"view"===mode&&isFocusedWithin(root)}function isFocusedWithin(element){return element.matches(FOCUS_WITHIN_SELECTOR)}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Table=({children,columns,hideColumnIndicators})=>{const columnNodes=range(columns+(hideColumnIndicators?0:1)).map((i=>(0,jsx_runtime.jsx)("col",{},i)));return(0,jsx_runtime.jsxs)("table",{className:"Spreadsheet__table",children:[(0,jsx_runtime.jsx)("colgroup",{children:columnNodes}),(0,jsx_runtime.jsx)("tbody",{children})]})};Table.displayName="Table";const src_Table=Table;try{TableComponent.displayName="TableComponent",TableComponent.__docgenInfo={description:"Type of the Spreadsheet Table component",displayName:"TableComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Table.tsx#TableComponent"]={docgenInfo:TableComponent.__docgenInfo,name:"TableComponent",path:"src/Table.tsx#TableComponent"})}catch(__react_docgen_typescript_loader_error){}const Row=props=>(0,jsx_runtime.jsx)("tr",{...props});Row.displayName="Row";const src_Row=Row;try{RowComponent.displayName="RowComponent",RowComponent.__docgenInfo={description:"Type of the Row component",displayName:"RowComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Row.tsx#RowComponent"]={docgenInfo:RowComponent.__docgenInfo,name:"RowComponent",path:"src/Row.tsx#RowComponent"})}catch(__react_docgen_typescript_loader_error){}const HeaderRow=props=>(0,jsx_runtime.jsx)("tr",{...props});HeaderRow.displayName="HeaderRow";const src_HeaderRow=HeaderRow;try{HeaderRowComponent.displayName="HeaderRowComponent",HeaderRowComponent.__docgenInfo={description:"Type of the HeaderRow component",displayName:"HeaderRowComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/HeaderRow.tsx#HeaderRowComponent"]={docgenInfo:HeaderRowComponent.__docgenInfo,name:"HeaderRowComponent",path:"src/HeaderRow.tsx#HeaderRowComponent"})}catch(__react_docgen_typescript_loader_error){}var index_modern=__webpack_require__("./node_modules/use-context-selector/dist/index.modern.js"),fast_formula_parser=__webpack_require__("./node_modules/fast-formula-parser/index.js"),fast_formula_parser_default=__webpack_require__.n(fast_formula_parser);const FORMULA_VALUE_PREFIX="=";function isFormulaValue(value){return"string"==typeof value&&value.startsWith(FORMULA_VALUE_PREFIX)&&value.length>1}function extractFormula(value){return value.slice(1)}function createBoundFormulaParser(getData){return new(fast_formula_parser_default())({onCell:ref=>{const cell=get({row:ref.row-1,column:ref.col-1},getData());return isNaN(cell?.value)?cell?.value:Number(cell?.value)},onRange:ref=>{const data=getData(),size=getSize(data);return function toArray(matrix,transform){const array=[];for(let row=0;row<matrix.length;row++)for(let column=0;column<matrix[row].length;column++){const value=matrix[row][column];array.push(transform?transform(value,{row,column}):value)}return array}(slice({row:ref.from.row-1,column:ref.from.col-1},{row:Math.min(ref.to.row-1,size.rows-1),column:Math.min(ref.to.col-1,size.columns-1)},data),(cell=>isNaN(cell?.value)?cell?.value:Number(cell?.value)))}})}const depParser=new fast_formula_parser.DepParser;function getReferences(formula,point,data){const{rows,columns}=getSize(data);try{const references=point_set_from(depParser.parse(formula,convertPointToCellRef(point)).flatMap((reference=>{if("from"in reference){const{from,to}=reference,range=create({row:from.row-1,column:from.col-1},{row:Math.min(to.row-1,rows-1),column:Math.min(to.col-1,columns-1)});return Array.from(iterate(range))}return{row:reference.row-1,column:reference.col-1}})));return references}catch(error){if(console.error(error),error instanceof fast_formula_parser.FormulaError)return point_set_from([]);throw error}}function convertPointToCellRef(point){return{row:point.row+1,col:point.column+1,sheet:"Sheet1"}}function*getBackwardsRecursive(point,graph){const stack=[point];for(;stack.length>0;){const current=stack.pop();if(!current)continue;const backwardDependencies=point_map_get(current,graph.backward);if(backwardDependencies)for(const dependent of point_set_entries(backwardDependencies))yield dependent,stack.push(dependent)}}class Model{constructor(data,referenceGraph,evaluatedData){this.data=data,this.referenceGraph=referenceGraph||function createReferenceGraph(data){const entries=[];for(const[point,cell]of matrix_entries(data))if(cell&&isFormulaValue(cell.value)){const references=getReferences(extractFormula(cell.value),point,data);entries.push([point,references])}return function point_graph_from(pairs){let backward=from([]);for(const[point,points]of pairs){const set=point_map_get(point,backward)||point_set_from([]);for(const p of point_set_toArray(points))backward=point_map_set(p,add(point,set),backward)}return{forward:from(pairs),backward}}(entries)}(data),this.evaluatedData=evaluatedData||function createEvaluatedData(data,referenceGraph){let evaluatedData=data;const formulaParser=createBoundFormulaParser((()=>evaluatedData));for(const point of function*traverseBFS(graph){let visited=point_set_from([]);const queue=[];for(const[point,dependencies]of entries(graph.forward))0!==point_set_size(dependencies)||point_set_has(visited,point)||(queue.push(point),visited=add(point,visited));for(;queue.length>0;){const point=queue.shift();if(!point)continue;yield point;const dependents=point_map_get(point,graph.forward);if(dependents)for(const dependent of point_set_entries(dependents))point_set_has(visited,dependent)||(queue.push(dependent),visited=add(dependent,visited))}}(referenceGraph)){const cell=get(point,data);if(cell&&isFormulaValue(cell.value)){const evaluatedValue=getFormulaComputedValue(cell.value,point,formulaParser);evaluatedData=set(point,{...cell,value:evaluatedValue},evaluatedData)}}return evaluatedData}(data,this.referenceGraph)}}function updateCellValue(model,point,cell){const nextData=set(point,cell,model.data),nextReferenceGraph=isFormulaValue(cell.value)?function updateReferenceGraph(referenceGraph,point,cell,data){const references=getReferences(extractFormula(cell.value),point,data),nextReferenceGraph=function point_graph_set(point,points,graph){const newForward=0===point_set_size(points)?point_map_unset(point,graph.forward):point_map_set(point,points,graph.forward),existing=point_map_get(point,graph.forward),toAdd=existing?subtract(existing,points):points;let newBackward=graph.backward;for(const p of point_set_toArray(toAdd))newBackward=point_map_set(p,add(point,point_map_get(p,newBackward)||point_set_from([])),newBackward);if(existing){const toRemove=subtract(points,existing);for(const p of point_set_toArray(toRemove)){const set=point_map_get(p,newBackward);if(!set)continue;const newSet=remove(point,set);newBackward=0===point_set_size(newSet)?point_map_unset(p,newBackward):point_map_set(p,newSet,newBackward)}}return{forward:newForward,backward:newBackward}}(point,references,referenceGraph);return nextReferenceGraph}(model.referenceGraph,point,cell,nextData):model.referenceGraph,nextEvaluatedData=function evaluateCell(prevEvaluatedData,data,referenceGraph,point,cell){if(function hasCircularDependency(graph,startPoint){let visited=point_set_from([]);const stack=[startPoint];for(;stack.length>0;){const current=stack.pop();if(!current)continue;if(point_set_has(visited,current))return!0;visited=add(current,visited);const dependents=point_map_get(current,graph.forward);if(dependents)for(const dependent of point_set_entries(dependents))stack.push(dependent)}return!1}(referenceGraph,point)){let visited=point_set_from([point]),nextEvaluatedData=set(point,{...cell,value:"#REF!"},prevEvaluatedData);for(const referrer of getBackwardsRecursive(point,referenceGraph)){if(point_set_has(visited,referrer))break;visited=add(referrer,visited);const referrerCell=get(referrer,data);referrerCell&&(nextEvaluatedData=set(referrer,{...referrerCell,value:"#REF!"},nextEvaluatedData))}return nextEvaluatedData}let nextEvaluatedData=prevEvaluatedData;const formulaParser=createBoundFormulaParser((()=>nextEvaluatedData)),evaluatedValue=isFormulaValue(cell.value)?getFormulaComputedValue(cell.value,point,formulaParser):cell.value,evaluatedCell={...cell,value:evaluatedValue};nextEvaluatedData=set(point,evaluatedCell,nextEvaluatedData);for(const referrer of getBackwardsRecursive(point,referenceGraph)){const referrerCell=get(referrer,data);if(!referrerCell)continue;const evaluatedValue=isFormulaValue(referrerCell.value)?getFormulaComputedValue(referrerCell.value,point,formulaParser):referrerCell.value,evaluatedCell={...referrerCell,value:evaluatedValue};nextEvaluatedData=set(referrer,evaluatedCell,nextEvaluatedData)}return nextEvaluatedData}(model.evaluatedData,nextData,nextReferenceGraph,point,cell);return new Model(nextData,nextReferenceGraph,nextEvaluatedData)}function getFormulaComputedValue(value,point,formulaParser){return function evaluate(formula,point,formulaParser){try{const position=convertPointToCellRef(point),returned=formulaParser.parse(formula,position);return returned instanceof fast_formula_parser.FormulaError?returned.toString():returned}catch(error){if(error instanceof fast_formula_parser.FormulaError)return error.toString();throw error}}(extractFormula(value),point,formulaParser)}const INITIAL_STATE={active:null,mode:"view",rowDimensions:{},columnDimensions:{},lastChanged:null,hasPasted:!1,cut:!1,dragging:!1,model:new Model([]),selected:null,copied:from([]),lastCommit:null};function reducer(state,action){switch(action.type){case"SET_DATA":{const{data}=action.payload,nextActive=state.active&&has(state.active,data)?state.active:null,nextSelected=function normalize(selection,data){if(selection){if(point_range_is(selection))return normalizeRange(selection,data);switch(selection.type){case EntireType.Row:return normalizeEntireRows(selection,data);case EntireType.Column:return normalizeEntireColumns(selection,data)}}return selection}(state.selected,data);return{...state,model:new Model(data),active:nextActive,selected:nextSelected}}case"SELECT_ENTIRE_ROW":{const{row,extend}=action.payload,{active}=state;return{...state,selected:createEntireRows(extend&&active?active.row:row,row),active:extend&&active?active:{...ORIGIN,row},mode:"view"}}case"SELECT_ENTIRE_COLUMN":{const{column,extend}=action.payload,{active}=state;return{...state,selected:createEntireColumns(extend&&active?active.column:column,column),active:extend&&active?active:{...ORIGIN,column},mode:"view"}}case"SELECT_ENTIRE_TABLE":return{...state,selected:{type:EntireType.Table},active:ORIGIN,mode:"view"};case"SELECT":{const{point}=action.payload;return state.active&&!isActive(state.active,point)?{...state,selected:create(point,state.active),mode:"view"}:state}case"ACTIVATE":{const{point}=action.payload;return{...state,selected:create(point,point),active:point,mode:isActive(state.active,point)?"edit":"view"}}case"SET_CELL_DATA":{const{active,data:cellData}=action.payload;return isActiveReadOnly(state)?state:{...state,model:updateCellValue(state.model,active,cellData),lastChanged:active}}case"SET_CELL_DIMENSIONS":{const{point,dimensions}=action.payload,prevRowDimensions=state.rowDimensions[point.row],prevColumnDimensions=state.columnDimensions[point.column];return prevRowDimensions&&prevColumnDimensions&&prevRowDimensions.top===dimensions.top&&prevRowDimensions.height===dimensions.height&&prevColumnDimensions.left===dimensions.left&&prevColumnDimensions.width===dimensions.width?state:{...state,rowDimensions:{...state.rowDimensions,[point.row]:{top:dimensions.top,height:dimensions.height}},columnDimensions:{...state.columnDimensions,[point.column]:{left:dimensions.left,width:dimensions.width}}}}case"COPY":case"CUT":{const selectedPoints=getPoints(state.selected,state.model.data);return{...state,copied:selectedPoints.reduce(((acc,point)=>{const cell=get(point,state.model.data);return void 0===cell?acc:point_map_set(point,cell,acc)}),from([])),cut:"CUT"===action.type,hasPasted:!1}}case"PASTE":{const{data:text}=action.payload,{active}=state;if(!active)return state;const copiedMatrix=function split(csv,transform,horizontalSeparator="\t",verticalSeparator=/\r\n|\n|\r/){return csv.split(verticalSeparator).map((row=>row.split(horizontalSeparator).map(transform)))}(text,(value=>({value}))),copied=function fromMatrix(matrix){return matrix.reduce(((rowAcc,data,row)=>data.reduce(((colAcc,cell,column)=>cell?point_map_set({row,column},cell,colAcc):colAcc),rowAcc)),EMPTY)}(copiedMatrix),minPoint=min(copied),copiedSize=getSize(copiedMatrix),requiredSize={rows:active.row+copiedSize.rows,columns:active.column+copiedSize.columns},paddedData=function pad(matrix,size){const{rows,columns}=getSize(matrix);if(rows>=size.rows&&columns>=size.columns)return matrix;const resultSize={rows:size.rows>rows?size.rows:rows,columns:size.columns>columns?size.columns:columns};let padded=[...matrix];if(resultSize.columns>columns){const padColumns=resultSize.columns-columns;padded=padded.map((row=>[...row,...Array(padColumns).fill(void 0)]))}if(resultSize.rows>rows){const padRows=resultSize.rows-rows,emptyRow=Array(resultSize.columns).fill(void 0);padded=[...padded,...Array(padRows).fill(emptyRow)]}return padded}(state.model.data,requiredSize),{data,commit}=reduce(((acc,value,point)=>{let commit=acc.commit||[];const nextPoint={row:point.row-minPoint.row+active.row,column:point.column-minPoint.column+active.column},nextData=state.cut?function unset(point,matrix){if(!has(point,matrix))return matrix;const nextMatrix=[...matrix],nextRow=[...matrix[point.row]];return nextRow[point.column]=void 0,nextMatrix[point.row]=nextRow,nextMatrix}(point,acc.data):acc.data;if(state.cut&&(commit=[...commit,{prevCell:value,nextCell:null}]),!has(nextPoint,paddedData))return{data:nextData,commit};const currentValue=get(nextPoint,nextData)||null;return commit=[...commit,{prevCell:currentValue,nextCell:value}],{data:set(nextPoint,{...currentValue,...value},nextData),commit}}),copied,{data:paddedData,commit:[]});return{...state,model:new Model(data),selected:create(active,{row:active.row+copiedSize.rows-1,column:active.column+copiedSize.columns-1}),cut:!1,hasPasted:!0,mode:"view",lastCommit:commit}}case"EDIT":return edit(state);case"VIEW":return view(state);case"CLEAR":return reducer_clear(state);case"BLUR":return reducer_blur(state);case"KEY_PRESS":{const{event}=action.payload;return isActiveReadOnly(state)||event.metaKey?state:"view"===state.mode&&state.active?edit(state):state}case"KEY_DOWN":{const{event}=action.payload,handler=getKeyDownHandler(state,event);return handler?{...state,...handler(state,event)}:state}case"DRAG_START":return{...state,dragging:!0};case"DRAG_END":return{...state,dragging:!1};case"COMMIT":{const{changes}=action.payload;return{...state,...commit(changes)}}}}function edit(state){return isActiveReadOnly(state)?state:{...state,mode:"edit"}}function reducer_clear(state){if(!state.active)return state;const clearCell=cell=>(cell=>cell&&!cell.readOnly)(cell)?Object.assign({},cell,{value:void 0}):cell,selectedPoints=getPoints(state.selected,state.model.data),changes=selectedPoints.map((point=>{const cell=get(point,state.model.data);return{...state,prevCell:cell||null,nextCell:clearCell(cell)||null}})),newData=selectedPoints.reduce(((acc,point)=>{const cell=get(point,acc);return set(point,clearCell(cell),acc)}),state.model.data);return{...state,model:new Model(newData),...commit(changes)}}function reducer_blur(state){return{...state,active:null,selected:null}}function view(state){return{...state,mode:"view"}}function commit(changes){return{lastCommit:changes}}const go=(rowDelta,columnDelta)=>state=>{if(!state.active)return;const nextActive={row:state.active.row+rowDelta,column:state.active.column+columnDelta};return has(nextActive,state.model.data)?{...state,active:nextActive,selected:create(nextActive,nextActive),mode:"view"}:{...state,mode:"view"}},keyDownHandlers={ArrowUp:go(-1,0),ArrowDown:go(1,0),ArrowLeft:go(0,-1),ArrowRight:go(0,1),Tab:go(0,1),Enter:edit,Backspace:reducer_clear,Delete:reducer_clear,Escape:reducer_blur},editKeyDownHandlers={Escape:view,Tab:keyDownHandlers.Tab,Enter:keyDownHandlers.ArrowDown},editShiftKeyDownHandlers={Tab:go(0,-1)},shiftKeyDownHandlers={ArrowUp:state=>({...state,selected:modifyEdge(state.selected,state.active,state.model.data,Direction.Top)}),ArrowDown:state=>({...state,selected:modifyEdge(state.selected,state.active,state.model.data,Direction.Bottom)}),ArrowLeft:state=>({...state,selected:modifyEdge(state.selected,state.active,state.model.data,Direction.Left)}),ArrowRight:state=>({...state,selected:modifyEdge(state.selected,state.active,state.model.data,Direction.Right)}),Tab:go(0,-1)},shiftMetaKeyDownHandlers={},metaKeyDownHandlers={};function getKeyDownHandler(state,event){const{key}=event;let handlers;return handlers="edit"===state.mode?event.shiftKey?editShiftKeyDownHandlers:editKeyDownHandlers:event.shiftKey&&event.metaKey?shiftMetaKeyDownHandlers:event.shiftKey?shiftKeyDownHandlers:event.metaKey?metaKeyDownHandlers:keyDownHandlers,handlers[key]}function isActiveReadOnly(state){const activeCell=function getActive(state){const activeCell=state.active&&get(state.active,state.model.data);return activeCell||null}(state);return Boolean(activeCell?.readOnly)}const src_context=(0,index_modern.kr)([INITIAL_STATE,()=>{}]);const use_dispatch=function useDispatch(){return(0,index_modern.Sz)(src_context,(([state,dispatch])=>dispatch))};const use_selector=function useSelector(selector){return(0,index_modern.Sz)(src_context,(([state])=>selector(state)))},CornerIndicator=({selected,onSelect})=>{const handleClick=react.useCallback((()=>{onSelect()}),[onSelect]);return(0,jsx_runtime.jsx)("th",{className:classnames_default()("Spreadsheet__header",{"Spreadsheet__header--selected":selected}),onClick:handleClick,tabIndex:0})};CornerIndicator.displayName="CornerIndicator";const src_CornerIndicator=CornerIndicator,enhance=CornerIndicatorComponent=>function CornerIndicatorWrapper(props){const dispatch=use_dispatch(),selectEntireTable=react.useCallback((()=>dispatch({type:"SELECT_ENTIRE_TABLE"})),[dispatch]),selected=use_selector((state=>isEntireTable(state.selected)));return(0,jsx_runtime.jsx)(CornerIndicatorComponent,{...props,selected,onSelect:selectEntireTable})};try{CornerIndicatorComponent.displayName="CornerIndicatorComponent",CornerIndicatorComponent.__docgenInfo={description:"Type of the CornerIndicator component",displayName:"CornerIndicatorComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/CornerIndicator.tsx#CornerIndicatorComponent"]={docgenInfo:CornerIndicatorComponent.__docgenInfo,name:"CornerIndicatorComponent",path:"src/CornerIndicator.tsx#CornerIndicatorComponent"})}catch(__react_docgen_typescript_loader_error){}try{enhance.displayName="enhance",enhance.__docgenInfo={description:"",displayName:"enhance",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/CornerIndicator.tsx#enhance"]={docgenInfo:enhance.__docgenInfo,name:"enhance",path:"src/CornerIndicator.tsx#enhance"})}catch(__react_docgen_typescript_loader_error){}const ColumnIndicator=({column,label,selected,onSelect})=>{const handleClick=react.useCallback((event=>{onSelect(column,event.shiftKey)}),[onSelect,column]);return(0,jsx_runtime.jsx)("th",{className:classnames_default()("Spreadsheet__header",{"Spreadsheet__header--selected":selected}),onClick:handleClick,tabIndex:0,children:void 0!==label?label:columnIndexToLabel(column)})};ColumnIndicator.displayName="ColumnIndicator";const src_ColumnIndicator=ColumnIndicator,ColumnIndicator_enhance=ColumnIndicatorComponent=>function ColumnIndicatorWrapper(props){const dispatch=use_dispatch(),selectEntireColumn=react.useCallback(((column,extend)=>dispatch(function actions_selectEntireColumn(column,extend){return{type:"SELECT_ENTIRE_COLUMN",payload:{column,extend}}}(column,extend))),[dispatch]),selected=use_selector((state=>hasEntireColumn(state.selected,props.column)||isEntireTable(state.selected)));return(0,jsx_runtime.jsx)(ColumnIndicatorComponent,{...props,selected,onSelect:selectEntireColumn})};function columnIndexToLabel(column){let label="",index=column;for(;index>=0;)label=String.fromCharCode(65+index%26)+label,index=Math.floor(index/26)-1;return label}try{ColumnIndicatorComponent.displayName="ColumnIndicatorComponent",ColumnIndicatorComponent.__docgenInfo={description:"Type of the ColumnIndicator component",displayName:"ColumnIndicatorComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ColumnIndicator.tsx#ColumnIndicatorComponent"]={docgenInfo:ColumnIndicatorComponent.__docgenInfo,name:"ColumnIndicatorComponent",path:"src/ColumnIndicator.tsx#ColumnIndicatorComponent"})}catch(__react_docgen_typescript_loader_error){}try{ColumnIndicator_enhance.displayName="enhance",ColumnIndicator_enhance.__docgenInfo={description:"",displayName:"enhance",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ColumnIndicator.tsx#enhance"]={docgenInfo:ColumnIndicator_enhance.__docgenInfo,name:"enhance",path:"src/ColumnIndicator.tsx#enhance"})}catch(__react_docgen_typescript_loader_error){}const RowIndicator=({row,label,selected,onSelect})=>{const handleClick=react.useCallback((event=>{onSelect(row,event.shiftKey)}),[onSelect,row]);return(0,jsx_runtime.jsx)("th",{className:classnames_default()("Spreadsheet__header",{"Spreadsheet__header--selected":selected}),onClick:handleClick,tabIndex:0,children:void 0!==label?label:row+1})};RowIndicator.displayName="RowIndicator";const src_RowIndicator=RowIndicator,RowIndicator_enhance=RowIndicatorComponent=>function RowIndicatorWrapper(props){const dispatch=use_dispatch(),selected=use_selector((state=>hasEntireRow(state.selected,props.row)||isEntireTable(state.selected))),selectEntireRow=react.useCallback(((row,extend)=>dispatch(function actions_selectEntireRow(row,extend){return{type:"SELECT_ENTIRE_ROW",payload:{row,extend}}}(row,extend))),[dispatch]);return(0,jsx_runtime.jsx)(RowIndicatorComponent,{...props,selected,onSelect:selectEntireRow})};try{RowIndicatorComponent.displayName="RowIndicatorComponent",RowIndicatorComponent.__docgenInfo={description:"Type of the RowIndicator component",displayName:"RowIndicatorComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/RowIndicator.tsx#RowIndicatorComponent"]={docgenInfo:RowIndicatorComponent.__docgenInfo,name:"RowIndicatorComponent",path:"src/RowIndicator.tsx#RowIndicatorComponent"})}catch(__react_docgen_typescript_loader_error){}try{RowIndicator_enhance.displayName="enhance",RowIndicator_enhance.__docgenInfo={description:"",displayName:"enhance",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/RowIndicator.tsx#enhance"]={docgenInfo:RowIndicator_enhance.__docgenInfo,name:"enhance",path:"src/RowIndicator.tsx#enhance"})}catch(__react_docgen_typescript_loader_error){}const Cell_Cell=({row,column,DataViewer,selected,active,dragging,mode,data,evaluatedData,select,activate,setCellDimensions,setCellData})=>{const rootRef=react.useRef(null),point=react.useMemo((()=>({row,column})),[row,column]),handleMouseDown=react.useCallback((event=>{"view"===mode&&(setCellDimensions(point,getOffsetRect(event.currentTarget)),event.shiftKey?select(point):activate(point))}),[mode,setCellDimensions,point,select,activate]),handleMouseOver=react.useCallback((event=>{dragging&&(setCellDimensions(point,getOffsetRect(event.currentTarget)),select(point))}),[setCellDimensions,select,dragging,point]);return react.useEffect((()=>{const root=rootRef.current;selected&&root&&setCellDimensions(point,getOffsetRect(root)),root&&active&&"view"===mode&&root.focus()}),[setCellDimensions,selected,active,mode,point,data]),data&&data.DataViewer&&(DataViewer=data.DataViewer),(0,jsx_runtime.jsx)("td",{ref:rootRef,className:classnames_default()("Spreadsheet__cell",data?.className,{"Spreadsheet__cell--readonly":data?.readOnly}),onMouseOver:handleMouseOver,onMouseDown:handleMouseDown,tabIndex:0,children:(0,jsx_runtime.jsx)(DataViewer,{row,column,cell:data,evaluatedCell:evaluatedData,setCellData})})};Cell_Cell.displayName="Cell";const Cell_enhance=CellComponent=>function CellWrapper(props){const{row,column}=props,dispatch=use_dispatch(),setCellData=react.useCallback((data=>dispatch(actions_setCellData({column,row},data))),[dispatch,column,row]),select=react.useCallback((point=>dispatch(function actions_select(point){return{type:"SELECT",payload:{point}}}(point))),[dispatch]),activate=react.useCallback((point=>dispatch(function actions_activate(point){return{type:"ACTIVATE",payload:{point}}}(point))),[dispatch]),setCellDimensions=react.useCallback(((point,dimensions)=>dispatch(function actions_setCellDimensions(point,dimensions){return{type:"SET_CELL_DIMENSIONS",payload:{point,dimensions}}}(point,dimensions))),[dispatch]),active=use_selector((state=>isActive(state.active,{row,column}))),mode=use_selector((state=>active?state.mode:"view")),data=use_selector((state=>get({row,column},state.model.data))),evaluatedData=use_selector((state=>get({row,column},state.model.evaluatedData))),selected=use_selector((state=>function hasPoint(selection,data,point){const range=toRange(selection,data);return null!==range&&point_range_has(range,point)}(state.selected,state.model.data,{row,column}))),dragging=use_selector((state=>state.dragging)),copied=use_selector((state=>point_map_has({row,column},state.copied)));return(0,jsx_runtime.jsx)(CellComponent,{...props,selected,active,copied,dragging,mode,evaluatedData,data,select,activate,setCellDimensions,setCellData})};try{Cell_Cell.displayName="Cell",Cell_Cell.__docgenInfo={description:"",displayName:"Cell",props:{row:{defaultValue:null,description:"The row of the cell",name:"row",required:!0,type:{name:"number"}},column:{defaultValue:null,description:"The column of the cell",name:"column",required:!0,type:{name:"number"}},DataViewer:{defaultValue:null,description:"The DataViewer component to be used by the cell",name:"DataViewer",required:!0,type:{name:"DataViewerComponent<CellBase<any>>"}},selected:{defaultValue:null,description:"Whether the cell is selected",name:"selected",required:!0,type:{name:"boolean"}},active:{defaultValue:null,description:"Whether the cell is active",name:"active",required:!0,type:{name:"boolean"}},copied:{defaultValue:null,description:"Whether the cell is copied",name:"copied",required:!0,type:{name:"boolean"}},dragging:{defaultValue:null,description:"Whether the user is dragging",name:"dragging",required:!0,type:{name:"boolean"}},mode:{defaultValue:null,description:"The mode of the cell",name:"mode",required:!0,type:{name:"enum",value:[{value:'"view"'},{value:'"edit"'}]}},data:{defaultValue:null,description:"The data of the cell",name:"data",required:!0,type:{name:"CellBase<any> | undefined"}},evaluatedData:{defaultValue:null,description:"The evaluated data of the cell",name:"evaluatedData",required:!0,type:{name:"CellBase<any> | undefined"}},select:{defaultValue:null,description:"Select the cell at the given point",name:"select",required:!0,type:{name:"(point: Point) => void"}},activate:{defaultValue:null,description:"Activate the cell at the given point",name:"activate",required:!0,type:{name:"(point: Point) => void"}},setCellDimensions:{defaultValue:null,description:"Set the dimensions of the cell at the given point with the given dimensions",name:"setCellDimensions",required:!0,type:{name:"(point: Point, dimensions: Dimensions) => void"}},setCellData:{defaultValue:null,description:"Set data of the cell",name:"setCellData",required:!0,type:{name:"(cell: CellBase<any>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Cell.tsx#Cell"]={docgenInfo:Cell_Cell.__docgenInfo,name:"Cell",path:"src/Cell.tsx#Cell"})}catch(__react_docgen_typescript_loader_error){}try{Cell_enhance.displayName="enhance",Cell_enhance.__docgenInfo={description:"",displayName:"enhance",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Cell.tsx#enhance"]={docgenInfo:Cell_enhance.__docgenInfo,name:"enhance",path:"src/Cell.tsx#enhance"})}catch(__react_docgen_typescript_loader_error){}const DataViewer=({cell,evaluatedCell})=>{const value=evaluatedCell?.value??cell?.value;return"boolean"==typeof value?(0,jsx_runtime.jsx)("span",{className:"Spreadsheet__data-viewer Spreadsheet__data-viewer--boolean",children:convertBooleanToText(value)}):(0,jsx_runtime.jsx)("span",{className:"Spreadsheet__data-viewer",children:value})},src_DataViewer=DataViewer;function convertBooleanToText(value){return value?"TRUE":"FALSE"}try{convertBooleanToText.displayName="convertBooleanToText",convertBooleanToText.__docgenInfo={description:"",displayName:"convertBooleanToText",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/DataViewer.tsx#convertBooleanToText"]={docgenInfo:convertBooleanToText.__docgenInfo,name:"convertBooleanToText",path:"src/DataViewer.tsx#convertBooleanToText"})}catch(__react_docgen_typescript_loader_error){}try{DataViewer.displayName="DataViewer",DataViewer.__docgenInfo={description:"The default Spreadsheet DataViewer component",displayName:"DataViewer",props:{cell:{defaultValue:null,description:"The rendered cell by the component",name:"cell",required:!0,type:{name:"CellBase<Value> | undefined"}},column:{defaultValue:null,description:"The cell's column",name:"column",required:!0,type:{name:"number"}},row:{defaultValue:null,description:"The cell's row",name:"row",required:!0,type:{name:"number"}},setCellData:{defaultValue:null,description:"Set data of the cell",name:"setCellData",required:!0,type:{name:"(cell: Cell) => void"}},evaluatedCell:{defaultValue:null,description:"",name:"evaluatedCell",required:!0,type:{name:"CellBase<Value> | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/DataViewer.tsx#DataViewer"]={docgenInfo:DataViewer.__docgenInfo,name:"DataViewer",path:"src/DataViewer.tsx#DataViewer"})}catch(__react_docgen_typescript_loader_error){}const DataEditor=({onChange,cell})=>{const inputRef=react.useRef(null),handleChange=react.useCallback((event=>{onChange({...cell,value:event.target.value})}),[onChange,cell]);react.useEffect((()=>{inputRef.current&&function moveCursorToEnd(el){el.selectionStart=el.selectionEnd=el.value.length}(inputRef.current)}),[inputRef]);const value=cell?.value??"";return(0,jsx_runtime.jsx)("div",{className:"Spreadsheet__data-editor",children:(0,jsx_runtime.jsx)("input",{ref:inputRef,type:"text",onChange:handleChange,value,autoFocus:!0})})};DataEditor.displayName="DataEditor";const src_DataEditor=DataEditor;try{DataEditor.displayName="DataEditor",DataEditor.__docgenInfo={description:"The default Spreadsheet DataEditor component",displayName:"DataEditor",props:{cell:{defaultValue:null,description:"The rendered cell by the component",name:"cell",required:!0,type:{name:"CellBase<any> | undefined"}},column:{defaultValue:null,description:"The cell's column",name:"column",required:!0,type:{name:"number"}},row:{defaultValue:null,description:"The cell's row",name:"row",required:!0,type:{name:"number"}},onChange:{defaultValue:null,description:"Callback to be called when the cell's value is changed",name:"onChange",required:!0,type:{name:"(cell: CellBase<any>) => void"}},exitEditMode:{defaultValue:null,description:"Callback to be called when edit mode should be exited",name:"exitEditMode",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/DataEditor.tsx#DataEditor"]={docgenInfo:DataEditor.__docgenInfo,name:"DataEditor",path:"src/DataEditor.tsx#DataEditor"})}catch(__react_docgen_typescript_loader_error){}const ActiveCell=props=>{const rootRef=react.useRef(null),dispatch=use_dispatch(),setCellData=react.useCallback(((active,data)=>dispatch(actions_setCellData(active,data))),[dispatch]),edit=react.useCallback((()=>dispatch({type:"EDIT"})),[dispatch]),commit=react.useCallback((changes=>dispatch(function actions_commit(changes){return{type:"COMMIT",payload:{changes}}}(changes))),[dispatch]),view=react.useCallback((()=>{dispatch({type:"VIEW"})}),[dispatch]),active=use_selector((state=>state.active)),mode=use_selector((state=>state.mode)),cell=use_selector((state=>state.active?get(state.active,state.model.data):void 0)),dimensions=use_selector((state=>active?getCellDimensions(active,state.rowDimensions,state.columnDimensions):void 0)),hidden=react.useMemo((()=>!active||!dimensions),[active,dimensions]),initialCellRef=react.useRef(void 0),prevActiveRef=react.useRef(null),prevCellRef=react.useRef(void 0),handleChange=react.useCallback((cell=>{active&&setCellData(active,cell)}),[setCellData,active]);react.useEffect((()=>{const root=rootRef.current;!hidden&&root&&root.focus()}),[rootRef,hidden]),react.useEffect((()=>{const prevActive=prevActiveRef.current,prevCell=prevCellRef.current;if(prevActiveRef.current=active,prevCellRef.current=cell,!prevActive||!prevCell)return;const coordsChanged=active?.row!==prevActive.row||active?.column!==prevActive.column;if(coordsChanged||"edit"!==mode){const initialCell=initialCellRef.current;prevCell!==initialCell?commit([{prevCell:initialCell||null,nextCell:prevCell}]):coordsChanged||cell===prevCell||commit([{prevCell,nextCell:cell||null}]),initialCellRef.current=cell}}));const DataEditor=cell&&cell.DataEditor||props.DataEditor,readOnly=cell&&cell.readOnly;return hidden?null:(0,jsx_runtime.jsx)("div",{ref:rootRef,className:classnames_default()("Spreadsheet__active-cell",`Spreadsheet__active-cell--${mode}`),style:dimensions,onClick:"view"!==mode||readOnly?void 0:edit,tabIndex:0,children:"edit"===mode&&active&&(0,jsx_runtime.jsx)(DataEditor,{row:active.row,column:active.column,cell,onChange:handleChange,exitEditMode:view})})},src_ActiveCell=ActiveCell;try{ActiveCell.displayName="ActiveCell",ActiveCell.__docgenInfo={description:"",displayName:"ActiveCell",props:{DataEditor:{defaultValue:null,description:"",name:"DataEditor",required:!0,type:{name:"DataEditorComponent<CellBase<any>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ActiveCell.tsx#ActiveCell"]={docgenInfo:ActiveCell.__docgenInfo,name:"ActiveCell",path:"src/ActiveCell.tsx#ActiveCell"})}catch(__react_docgen_typescript_loader_error){}const FloatingRect=({dimensions,dragging,hidden,variant})=>{const{width,height,top,left}=dimensions||{};return(0,jsx_runtime.jsx)("div",{className:classnames_default()("Spreadsheet__floating-rect",{[`Spreadsheet__floating-rect--${variant}`]:variant,"Spreadsheet__floating-rect--dragging":dragging,"Spreadsheet__floating-rect--hidden":hidden}),style:{width,height,top,left}})};FloatingRect.displayName="FloatingRect";const src_FloatingRect=FloatingRect;try{FloatingRect.displayName="FloatingRect",FloatingRect.__docgenInfo={description:"",displayName:"FloatingRect",props:{variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"string"}},dimensions:{defaultValue:null,description:"",name:"dimensions",required:!1,type:{name:"Dimensions | null"}},hidden:{defaultValue:null,description:"",name:"hidden",required:!1,type:{name:"boolean"}},dragging:{defaultValue:null,description:"",name:"dragging",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/FloatingRect.tsx#FloatingRect"]={docgenInfo:FloatingRect.__docgenInfo,name:"FloatingRect",path:"src/FloatingRect.tsx#FloatingRect"})}catch(__react_docgen_typescript_loader_error){}const Selected=()=>{const selected=use_selector((state=>state.selected)),dimensions=use_selector((state=>selected&&function getSelectedDimensions(rowDimensions,columnDimensions,data,selected){const range=toRange(selected,data);return range?getRangeDimensions(rowDimensions,columnDimensions,range):void 0}(state.rowDimensions,state.columnDimensions,state.model.data,state.selected))),dragging=use_selector((state=>state.dragging)),hidden=use_selector((state=>function selection_size(selection,data){const range=toRange(selection,data);return range?function size(range){return(range.end.row+1-range.start.row)*(range.end.column+1-range.start.column)}(range):0}(state.selected,state.model.data)<2));return(0,jsx_runtime.jsx)(src_FloatingRect,{variant:"selected",dimensions,dragging,hidden})};Selected.displayName="Selected";const src_Selected=Selected;try{Selected.displayName="Selected",Selected.__docgenInfo={description:"",displayName:"Selected",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Selected.tsx#Selected"]={docgenInfo:Selected.__docgenInfo,name:"Selected",path:"src/Selected.tsx#Selected"})}catch(__react_docgen_typescript_loader_error){}const Copied=()=>{const range=use_selector((state=>getCopiedRange(state.copied,state.hasPasted))),dimensions=use_selector((state=>range&&getRangeDimensions(state.rowDimensions,state.columnDimensions,range))),hidden=null===range;return(0,jsx_runtime.jsx)(src_FloatingRect,{variant:"copied",dimensions,hidden,dragging:!1})};Copied.displayName="Copied";const src_Copied=Copied;try{Copied.displayName="Copied",Copied.__docgenInfo={description:"",displayName:"Copied",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Copied.tsx#Copied"]={docgenInfo:Copied.__docgenInfo,name:"Copied",path:"src/Copied.tsx#Copied"})}catch(__react_docgen_typescript_loader_error){}var injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),cjs_ruleSet_1_rules_7_use_1_src_Spreadsheet=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!./src/Spreadsheet.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(cjs_ruleSet_1_rules_7_use_1_src_Spreadsheet.Z,options);cjs_ruleSet_1_rules_7_use_1_src_Spreadsheet.Z&&cjs_ruleSet_1_rules_7_use_1_src_Spreadsheet.Z.locals&&cjs_ruleSet_1_rules_7_use_1_src_Spreadsheet.Z.locals;const Spreadsheet_Spreadsheet=props=>{const{className,darkMode,columnLabels,rowLabels,hideColumnIndicators,hideRowIndicators,onKeyDown,Table=src_Table,Row=src_Row,HeaderRow=src_HeaderRow,DataEditor=src_DataEditor,DataViewer=src_DataViewer,onChange=()=>{},onModeChange=()=>{},onSelect=()=>{},onActivate=()=>{},onBlur=()=>{},onCellCommit=()=>{}}=props,initialState=react.useMemo((()=>{const model=new Model(props.data);return{...INITIAL_STATE,model}}),[props.data]),reducerElements=react.useReducer(reducer,initialState),[state,dispatch]=reducerElements,size=react.useMemo((()=>function calculateSpreadsheetSize(data,rowLabels,columnLabels){const{columns,rows}=getSize(data);return{rows:rowLabels?Math.max(rows,rowLabels.length):rows,columns:columnLabels?Math.max(columns,columnLabels.length):columns}}(state.model.data,rowLabels,columnLabels)),[state.model.data,rowLabels,columnLabels]),mode=state.mode,rootRef=react.useRef(null),prevStateRef=react.useRef(initialState),copy=react.useCallback((()=>dispatch({type:"COPY"})),[dispatch]),cut=react.useCallback((()=>dispatch({type:"CUT"})),[dispatch]),paste=react.useCallback((data=>dispatch(function actions_paste(data){return{type:"PASTE",payload:{data}}}(data))),[dispatch]),onKeyDownAction=react.useCallback((event=>dispatch(function keyDown(event){return{type:"KEY_DOWN",payload:{event}}}(event))),[dispatch]),onKeyPress=react.useCallback((event=>dispatch(function keyPress(event){return{type:"KEY_PRESS",payload:{event}}}(event))),[dispatch]),onDragStart=react.useCallback((()=>dispatch({type:"DRAG_START"})),[dispatch]),onDragEnd=react.useCallback((()=>dispatch({type:"DRAG_END"})),[dispatch]),setData=react.useCallback((data=>dispatch(function actions_setData(data){return{type:"SET_DATA",payload:{data}}}(data))),[dispatch]),blur=react.useCallback((()=>dispatch({type:"BLUR"})),[dispatch]);react.useEffect((()=>{const prevState=prevStateRef.current;if(state.lastCommit&&state.lastCommit!==prevState.lastCommit)for(const change of state.lastCommit)onCellCommit(change.prevCell,change.nextCell,state.lastChanged);if(state.model.data!==prevState.model.data&&state.model.data!==props.data&&onChange(state.model.data),state.selected!==prevState.selected){const points=getPoints(state.selected,state.model.data);onSelect(points)}if(state.mode!==prevState.mode&&onModeChange(state.mode),state.active!==prevState.active)if(state.active)onActivate(state.active);else{const root=rootRef.current;root&&isFocusedWithin(root)&&document.activeElement&&document.activeElement.blur(),onBlur()}prevStateRef.current=state}),[props.data,state,onActivate,onBlur,onCellCommit,onChange,onModeChange,onSelect,rowLabels,columnLabels]),react.useEffect((()=>{const prevState=prevStateRef.current;props.data!==prevState.model.data&&setData(props.data)}),[props.data,setData]);const clip=react.useCallback((event=>{const{model,selected}=state,{data}=model;!function writeTextToClipboard(event,data){event.clipboardData?.setData("text/plain",data)}(event,getCSV(getSelectionFromMatrix(selected,data)))}),[state]),handleCut=react.useCallback((event=>{shouldHandleClipboardEvent(rootRef.current,mode)&&(event.preventDefault(),event.stopPropagation(),clip(event),cut())}),[mode,clip,cut]),handleCopy=react.useCallback((event=>{shouldHandleClipboardEvent(rootRef.current,mode)&&(event.preventDefault(),event.stopPropagation(),clip(event),copy())}),[mode,clip,copy]),handlePaste=react.useCallback((event=>{if(shouldHandleClipboardEvent(rootRef.current,mode)&&(event.preventDefault(),event.stopPropagation(),event.clipboardData)){const text=function readTextFromClipboard(event){return window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):event.clipboardData&&event.clipboardData.getData?event.clipboardData.getData("text/plain"):""}(event);paste(text)}}),[mode,paste]),handleKeyDown=react.useCallback((event=>{event.persist(),onKeyDown&&onKeyDown(event),event.defaultPrevented||(function hasKeyDownHandler(state,event){return void 0!==getKeyDownHandler(state,event)}(state,event)&&event.nativeEvent.preventDefault(),onKeyDownAction(event))}),[state,onKeyDown,onKeyDownAction]),handleMouseUp=react.useCallback((()=>{onDragEnd(),document.removeEventListener("mouseup",handleMouseUp)}),[onDragEnd]),handleMouseMove=react.useCallback((event=>{state.dragging||1!==event.buttons||(onDragStart(),document.addEventListener("mouseup",handleMouseUp))}),[state,onDragStart,handleMouseUp]),handleBlur=react.useCallback((event=>{event.currentTarget.contains(event.relatedTarget)||blur()}),[blur]),Cell=react.useMemo((()=>Cell_enhance(props.Cell||Cell_Cell)),[props.Cell]),CornerIndicator=react.useMemo((()=>enhance(props.CornerIndicator||src_CornerIndicator)),[props.CornerIndicator]),RowIndicator=react.useMemo((()=>RowIndicator_enhance(props.RowIndicator||src_RowIndicator)),[props.RowIndicator]),ColumnIndicator=react.useMemo((()=>ColumnIndicator_enhance(props.ColumnIndicator||src_ColumnIndicator)),[props.ColumnIndicator]);react.useEffect((()=>(document.addEventListener("cut",handleCut),document.addEventListener("copy",handleCopy),document.addEventListener("paste",handlePaste),()=>{document.removeEventListener("cut",handleCut),document.removeEventListener("copy",handleCopy),document.removeEventListener("paste",handlePaste)})),[handleCut,handleCopy,handlePaste]);const tableNode=react.useMemo((()=>(0,jsx_runtime.jsxs)(Table,{columns:size.columns,hideColumnIndicators,children:[(0,jsx_runtime.jsxs)(HeaderRow,{children:[!hideRowIndicators&&!hideColumnIndicators&&(0,jsx_runtime.jsx)(CornerIndicator,{}),!hideColumnIndicators&&range(size.columns).map((columnNumber=>columnLabels?(0,jsx_runtime.jsx)(ColumnIndicator,{column:columnNumber,label:columnNumber in columnLabels?columnLabels[columnNumber]:null},columnNumber):(0,jsx_runtime.jsx)(ColumnIndicator,{column:columnNumber},columnNumber)))]}),range(size.rows).map((rowNumber=>(0,jsx_runtime.jsxs)(Row,{row:rowNumber,children:[!hideRowIndicators&&(rowLabels?(0,jsx_runtime.jsx)(RowIndicator,{row:rowNumber,label:rowNumber in rowLabels?rowLabels[rowNumber]:null},rowNumber):(0,jsx_runtime.jsx)(RowIndicator,{row:rowNumber},rowNumber)),range(size.columns).map((columnNumber=>(0,jsx_runtime.jsx)(Cell,{row:rowNumber,column:columnNumber,DataViewer},columnNumber)))]},rowNumber)))]})),[Table,size.rows,size.columns,hideColumnIndicators,Row,HeaderRow,hideRowIndicators,CornerIndicator,columnLabels,ColumnIndicator,rowLabels,RowIndicator,Cell,DataViewer]),activeCellNode=react.useMemo((()=>(0,jsx_runtime.jsx)(src_ActiveCell,{DataEditor})),[DataEditor]),rootNode=react.useMemo((()=>(0,jsx_runtime.jsxs)("div",{ref:rootRef,className:classnames_default()("Spreadsheet",className,{"Spreadsheet--dark-mode":darkMode}),onKeyPress,onKeyDown:handleKeyDown,onMouseMove:handleMouseMove,onBlur:handleBlur,children:[tableNode,activeCellNode,(0,jsx_runtime.jsx)(src_Selected,{}),(0,jsx_runtime.jsx)(src_Copied,{})]})),[className,darkMode,onKeyPress,handleKeyDown,handleMouseMove,handleBlur,tableNode,activeCellNode]);return(0,jsx_runtime.jsx)(src_context.Provider,{value:reducerElements,children:rootNode})};Spreadsheet_Spreadsheet.displayName="Spreadsheet";const src_Spreadsheet_0=Spreadsheet_Spreadsheet;try{Spreadsheet_Spreadsheet.displayName="Spreadsheet",Spreadsheet_Spreadsheet.__docgenInfo={description:"The Spreadsheet component",displayName:"Spreadsheet",props:{data:{defaultValue:null,description:"The spreadsheet's data",name:"data",required:!0,type:{name:"Matrix<CellType>"}},className:{defaultValue:null,description:"Class to be added to the spreadsheet element",name:"className",required:!1,type:{name:"string"}},darkMode:{defaultValue:null,description:"Use dark colors that complenent dark mode",name:"darkMode",required:!1,type:{name:"boolean"}},columnLabels:{defaultValue:null,description:"Labels to use in column indicators.\nDefaults to: alphabetical labels.",name:"columnLabels",required:!1,type:{name:"string[]"}},rowLabels:{defaultValue:null,description:"Labels to use in row indicators.\nDefaults to: row index labels.",name:"rowLabels",required:!1,type:{name:"string[]"}},hideRowIndicators:{defaultValue:null,description:"If set to true, hides the row indicators of the spreadsheet.\nDefaults to: `false`.",name:"hideRowIndicators",required:!1,type:{name:"boolean"}},hideColumnIndicators:{defaultValue:null,description:"If set to true, hides the column indicators of the spreadsheet.\nDefaults to: `false`.",name:"hideColumnIndicators",required:!1,type:{name:"boolean"}},ColumnIndicator:{defaultValue:null,description:"Component rendered above each column.",name:"ColumnIndicator",required:!1,type:{name:"ColumnIndicatorComponent"}},CornerIndicator:{defaultValue:null,description:"Component rendered in the corner of row and column indicators.",name:"CornerIndicator",required:!1,type:{name:"CornerIndicatorComponent"}},RowIndicator:{defaultValue:null,description:"Component rendered next to each row.",name:"RowIndicator",required:!1,type:{name:"RowIndicatorComponent"}},Table:{defaultValue:null,description:"The Spreadsheet's table component.",name:"Table",required:!1,type:{name:"TableComponent"}},Row:{defaultValue:null,description:"The Spreadsheet's row component.",name:"Row",required:!1,type:{name:"RowComponent"}},HeaderRow:{defaultValue:null,description:"The spreadsheet's header row component",name:"HeaderRow",required:!1,type:{name:"HeaderRowComponent"}},Cell:{defaultValue:null,description:"The Spreadsheet's cell component.",name:"Cell",required:!1,type:{name:"CellComponent<CellType>"}},DataViewer:{defaultValue:null,description:"Component rendered for cells in view mode.",name:"DataViewer",required:!1,type:{name:"DataViewerComponent<CellType>"}},DataEditor:{defaultValue:null,description:"Component rendered for cells in edit mode.",name:"DataEditor",required:!1,type:{name:"DataEditorComponent<CellType>"}},onKeyDown:{defaultValue:null,description:"Callback called on key down inside the spreadsheet.",name:"onKeyDown",required:!1,type:{name:"((event: KeyboardEvent<Element>) => void)"}},onChange:{defaultValue:null,description:"Callback called when the Spreadsheet's data changes.",name:"onChange",required:!1,type:{name:"((data: Matrix<CellType>) => void)"}},onModeChange:{defaultValue:null,description:"Callback called when the Spreadsheet's edit mode changes.",name:"onModeChange",required:!1,type:{name:"((mode: Mode) => void)"}},onSelect:{defaultValue:null,description:"Callback called when the Spreadsheet's selection changes.",name:"onSelect",required:!1,type:{name:"((selected: Point[]) => void)"}},onActivate:{defaultValue:null,description:"Callback called when Spreadsheet's active cell changes.",name:"onActivate",required:!1,type:{name:"((active: Point) => void)"}},onBlur:{defaultValue:null,description:"Callback called when the Spreadsheet loses focus",name:"onBlur",required:!1,type:{name:"(() => void)"}},onCellCommit:{defaultValue:null,description:"",name:"onCellCommit",required:!1,type:{name:"((prevCell: CellType | null, nextCell: CellType | null, coords: Point | null) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/Spreadsheet.tsx#Spreadsheet"]={docgenInfo:Spreadsheet_Spreadsheet.__docgenInfo,name:"Spreadsheet",path:"src/Spreadsheet.tsx#Spreadsheet"})}catch(__react_docgen_typescript_loader_error){}const AsyncCellDataViewer=({cell})=>{const value=cell?.value;return(0,jsx_runtime.jsxs)("div",{children:[value,(0,jsx_runtime.jsx)("button",{disabled:!0,children:"Click Me"})]})};AsyncCellDataViewer.displayName="AsyncCellDataViewer";const AsyncCellDataEditor=({onChange,cell})=>{const[loading,setLoading]=react.useState(!1),handleClick=react.useCallback((()=>{setLoading(!0),setTimeout((()=>{setLoading(!1);const nextValue=Math.floor(100*Math.random());onChange({value:nextValue})}),1e3)}),[setLoading,onChange]),value=cell?.value;return(0,jsx_runtime.jsxs)("div",{children:[value,loading?"Loading...":(0,jsx_runtime.jsx)("button",{onClick:handleClick,children:"Click Me"})]})};AsyncCellDataEditor.displayName="AsyncCellDataEditor";const CustomCell=({column,row,setCellDimensions,select,activate,mode,dragging,active,data,evaluatedData,DataViewer,setCellData})=>{const rootRef=react.createRef();react.useEffect((()=>{setCellDimensions({row,column},{height:30,width:96,left:96*(column+1),top:30*(row+1)})}),[setCellDimensions,column,row]),react.useEffect((()=>{rootRef.current&&active&&"view"===mode&&rootRef.current.focus()}),[rootRef,active,mode]);const handleMouseDown=react.useCallback((event=>{if("view"===mode){if(event.shiftKey)return void select({row,column});activate({row,column})}}),[select,activate,column,mode,row]),handleMouseOver=react.useCallback((()=>{dragging&&select({row,column})}),[dragging,select,column,row]);return data&&data.DataViewer&&({DataViewer,...data}=data),(0,jsx_runtime.jsx)("td",{ref:rootRef,className:classnames_default()("Spreadsheet__cell",data&&data.readOnly&&"Spreadsheet__cell--readonly",data&&data.className),style:{borderColor:active?"black":"none"},tabIndex:0,onMouseOver:handleMouseOver,onMouseDown:handleMouseDown,children:(0,jsx_runtime.jsx)(DataViewer,{row,column,cell:data,evaluatedCell:evaluatedData,setCellData})})};CustomCell.displayName="CustomCell";const stories_CustomCell=CustomCell;try{CellComponent.displayName="CellComponent",CellComponent.__docgenInfo={description:"Type of the Spreadsheet Cell component",displayName:"CellComponent",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/stories/CustomCell.tsx#CellComponent"]={docgenInfo:CellComponent.__docgenInfo,name:"CellComponent",path:"src/stories/CustomCell.tsx#CellComponent"})}catch(__react_docgen_typescript_loader_error){}const RangeView=({cell})=>(0,jsx_runtime.jsx)("input",{type:"range",value:cell?.value,disabled:!0,style:{pointerEvents:"none"}});RangeView.displayName="RangeView";const RangeEdit=({cell,onChange})=>{const handleChange=react.useCallback((event=>{onChange({...cell,value:Number(event.target.value)})}),[cell,onChange]),value=cell?.value||0;return(0,jsx_runtime.jsx)("input",{autoFocus:!0,type:"range",onChange:handleChange,value})};RangeEdit.displayName="RangeEdit";var react_select_esm=__webpack_require__("./node_modules/react-select/dist/react-select.esm.js");const OPTIONS=[{value:"vanilla",label:"Vanilla"},{value:"chocolate",label:"Chocolate"},{value:"caramel",label:"Caramel"}],SelectView=({cell})=>{const option=react.useMemo((()=>cell&&OPTIONS.find((option=>option.value===cell.value))),[cell]);return(0,jsx_runtime.jsx)(react_select_esm.ZP,{value:option,options:OPTIONS,isDisabled:!0})};SelectView.displayName="SelectView";const SelectEdit=({cell,onChange,exitEditMode})=>{const handleChange=react.useCallback((selection=>{onChange({...cell,value:selection?selection.value:null})}),[cell,onChange]),option=react.useMemo((()=>cell&&OPTIONS.find((option=>option.value===cell.value))),[cell]);return(0,jsx_runtime.jsx)(react_select_esm.ZP,{value:option,onChange:handleChange,options:OPTIONS,autoFocus:!0,defaultMenuIsOpen:!0,onMenuClose:()=>exitEditMode()})};SelectEdit.displayName="SelectEdit";const CustomCornerIndicator=()=>(0,jsx_runtime.jsx)("th",{className:"Spreadsheet__header",style:{position:"relative"},onClick:()=>alert("You clicked the corner indicator!"),children:(0,jsx_runtime.jsx)("div",{style:{bottom:-3,position:"absolute",right:1,width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:"8px solid #777",transform:"rotate(45deg)"}})});CustomCornerIndicator.displayName="CustomCornerIndicator";try{CustomCornerIndicator.displayName="CustomCornerIndicator",CustomCornerIndicator.__docgenInfo={description:"",displayName:"CustomCornerIndicator",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/stories/CustomCornerIndicator.tsx#CustomCornerIndicator"]={docgenInfo:CustomCornerIndicator.__docgenInfo,name:"CustomCornerIndicator",path:"src/stories/CustomCornerIndicator.tsx#CustomCornerIndicator"})}catch(__react_docgen_typescript_loader_error){}const EMPTY_DATA=createEmpty(6,4),Spreadsheet_stories={title:"Spreadsheet",component:src_Spreadsheet_0,parameters:{controls:{expanded:!0,exclude:/ColumnIndicator|CornerIndicator|RowIndicator|Cell|HeaderRow|DataViewer|DataEditor|Row|Table/}},args:{data:EMPTY_DATA},argTypes:{columnLabels:{control:"array",defaultValue:[]},rowLabels:{control:"array",defaultValue:[]}},decorators:[Story=>(0,jsx_runtime.jsx)("div",{onKeyDown:e=>{(e.target instanceof HTMLElement&&e.target.classList.contains("Spreadsheet__active-cell")||e.target instanceof HTMLInputElement)&&e.stopPropagation()},children:(0,jsx_runtime.jsx)(Story,{})})]},Basic=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props});Basic.displayName="Basic";const DarkMode=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,darkMode:!0});DarkMode.displayName="DarkMode";const Controlled=props=>{const[data,setData]=react.useState(EMPTY_DATA),addColumn=react.useCallback((()=>setData((data=>data.map((row=>{const nextRow=[...row];return nextRow.length+=1,nextRow}))))),[setData]),removeColumn=react.useCallback((()=>{setData((data=>data.map((row=>row.slice(0,row.length-1)))))}),[setData]),addRow=react.useCallback((()=>setData((data=>{const{columns}=getSize(data);return[...data,Array(columns)]}))),[setData]),removeRow=react.useCallback((()=>{setData((data=>data.slice(0,data.length-1)))}),[setData]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("button",{onClick:addColumn,children:"Add column"}),(0,jsx_runtime.jsx)("button",{onClick:addRow,children:"Add row"}),(0,jsx_runtime.jsx)("button",{onClick:removeColumn,children:"Remove column"}),(0,jsx_runtime.jsx)("button",{onClick:removeRow,children:"Remove row"})]}),(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,data,onChange:setData})]})},CustomRowLabels=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,rowLabels:["Dan","Alice","Bob","Steve","Adam","Ruth"]});CustomRowLabels.displayName="CustomRowLabels";const CustomColumnLabels=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,columnLabels:["Name","Age","Email","Address"]});CustomColumnLabels.displayName="CustomColumnLabels";const HideIndicators=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,hideColumnIndicators:!0,hideRowIndicators:!0});HideIndicators.displayName="HideIndicators";const Readonly=props=>{const data=createEmpty(6,4);return data[0][0]={readOnly:!0,value:"Read Only"},(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,data})};Readonly.displayName="Readonly";const WithAsyncCellData=props=>{const data=createEmpty(6,4);return data[2][2]={value:void 0,DataViewer:AsyncCellDataViewer,DataEditor:AsyncCellDataEditor},(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,data})};WithAsyncCellData.displayName="WithAsyncCellData";const WithCustomCell=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,Cell:stories_CustomCell});WithCustomCell.displayName="WithCustomCell";const RangeCell=props=>{const data=createEmpty(6,4);return data[2][2]={value:0,DataViewer:RangeView,DataEditor:RangeEdit},(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,data})};RangeCell.displayName="RangeCell";const WithSelectCell=props=>{const data=createEmpty(6,4);return data[2][2]={value:void 0,DataViewer:SelectView,DataEditor:SelectEdit,className:"select-cell"},(0,jsx_runtime.jsx)(src_Spreadsheet_0,{data})};WithSelectCell.displayName="WithSelectCell";const WithCornerIndicator=props=>(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,CornerIndicator:CustomCornerIndicator});WithCornerIndicator.displayName="WithCornerIndicator";const Filter=props=>{const[data,setData]=react.useState(EMPTY_DATA),[filter,setFilter]=react.useState(""),handleFilterChange=react.useCallback((event=>{const nextFilter=event.target.value;setFilter(nextFilter)}),[setFilter]),filtered=react.useMemo((()=>{if(0===filter.length)return data;const filtered=[];for(let row=0;row<data.length;row++)if(0!==data.length)for(let column=0;column<data[0].length;column++){const cell=data[row][column];cell&&cell.value&&cell.value.includes(filter)&&(filtered[0]||(filtered[0]=[]),filtered[0].length<column&&(filtered[0].length=column+1),filtered[row]||(filtered[row]=[]),filtered[row][column]=cell)}return filtered}),[data,filter]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("input",{type:"text",placeholder:"Filter",value:filter,onChange:handleFilterChange})}),(0,jsx_runtime.jsx)(src_Spreadsheet_0,{...props,data:filtered,onChange:setData})]})};Basic.parameters={...Basic.parameters,docs:{...Basic.parameters?.docs,source:{originalSource:"props => <Spreadsheet {...props} />",...Basic.parameters?.docs?.source}}},DarkMode.parameters={...DarkMode.parameters,docs:{...DarkMode.parameters?.docs,source:{originalSource:"props => <Spreadsheet {...props} darkMode />",...DarkMode.parameters?.docs?.source}}},Controlled.parameters={...Controlled.parameters,docs:{...Controlled.parameters?.docs,source:{originalSource:"props => {\n  const [data, setData] = React.useState(EMPTY_DATA);\n  const addColumn = React.useCallback(() => setData(data => data.map(row => {\n    const nextRow = [...row];\n    nextRow.length += 1;\n    return nextRow;\n  })), [setData]);\n  const removeColumn = React.useCallback(() => {\n    setData(data => data.map(row => {\n      return row.slice(0, row.length - 1);\n    }));\n  }, [setData]);\n  const addRow = React.useCallback(() => setData(data => {\n    const {\n      columns\n    } = Matrix.getSize(data);\n    return [...data, Array(columns)];\n  }), [setData]);\n  const removeRow = React.useCallback(() => {\n    setData(data => {\n      return data.slice(0, data.length - 1);\n    });\n  }, [setData]);\n  return <>\n      <div>\n        <button onClick={addColumn}>Add column</button>\n        <button onClick={addRow}>Add row</button>\n        <button onClick={removeColumn}>Remove column</button>\n        <button onClick={removeRow}>Remove row</button>\n      </div>\n      <Spreadsheet {...props} data={data} onChange={setData} />\n    </>;\n}",...Controlled.parameters?.docs?.source}}},CustomRowLabels.parameters={...CustomRowLabels.parameters,docs:{...CustomRowLabels.parameters?.docs,source:{originalSource:'props => <Spreadsheet {...props} rowLabels={["Dan", "Alice", "Bob", "Steve", "Adam", "Ruth"]} />',...CustomRowLabels.parameters?.docs?.source}}},CustomColumnLabels.parameters={...CustomColumnLabels.parameters,docs:{...CustomColumnLabels.parameters?.docs,source:{originalSource:'props => <Spreadsheet {...props} columnLabels={["Name", "Age", "Email", "Address"]} />',...CustomColumnLabels.parameters?.docs?.source}}},HideIndicators.parameters={...HideIndicators.parameters,docs:{...HideIndicators.parameters?.docs,source:{originalSource:"props => <Spreadsheet {...props} hideColumnIndicators hideRowIndicators />",...HideIndicators.parameters?.docs?.source}}},Readonly.parameters={...Readonly.parameters,docs:{...Readonly.parameters?.docs,source:{originalSource:'props => {\n  const data = createEmptyMatrix<StringCell>(INITIAL_ROWS, INITIAL_COLUMNS);\n  data[0][0] = {\n    readOnly: true,\n    value: "Read Only"\n  };\n  return <Spreadsheet {...props} data={data} />;\n}',...Readonly.parameters?.docs?.source}}},WithAsyncCellData.parameters={...WithAsyncCellData.parameters,docs:{...WithAsyncCellData.parameters?.docs,source:{originalSource:"props => {\n  const data = createEmptyMatrix<StringCell>(INITIAL_ROWS, INITIAL_COLUMNS);\n  data[2][2] = {\n    value: undefined,\n    DataViewer: AsyncCellDataViewer,\n    DataEditor: AsyncCellDataEditor\n  };\n  return <Spreadsheet {...props} data={data} />;\n}",...WithAsyncCellData.parameters?.docs?.source}}},WithCustomCell.parameters={...WithCustomCell.parameters,docs:{...WithCustomCell.parameters?.docs,source:{originalSource:"props => <Spreadsheet {...props} Cell={CustomCell} />",...WithCustomCell.parameters?.docs?.source}}},RangeCell.parameters={...RangeCell.parameters,docs:{...RangeCell.parameters?.docs,source:{originalSource:"props => {\n  const data = createEmptyMatrix<NumberCell>(INITIAL_ROWS, INITIAL_COLUMNS);\n  data[2][2] = {\n    value: 0,\n    DataViewer: RangeView,\n    DataEditor: RangeEdit\n  };\n  return <Spreadsheet {...props} data={data} />;\n}",...RangeCell.parameters?.docs?.source}}},WithSelectCell.parameters={...WithSelectCell.parameters,docs:{...WithSelectCell.parameters?.docs,source:{originalSource:'props => {\n  const data = createEmptyMatrix<StringCell>(INITIAL_ROWS, INITIAL_COLUMNS);\n  data[2][2] = {\n    value: undefined,\n    DataViewer: SelectView,\n    DataEditor: SelectEdit,\n    className: "select-cell"\n  };\n  return <Spreadsheet data={data} />;\n}',...WithSelectCell.parameters?.docs?.source}}},WithCornerIndicator.parameters={...WithCornerIndicator.parameters,docs:{...WithCornerIndicator.parameters?.docs,source:{originalSource:"props => <Spreadsheet {...props} CornerIndicator={CustomCornerIndicator} />",...WithCornerIndicator.parameters?.docs?.source}}},Filter.parameters={...Filter.parameters,docs:{...Filter.parameters?.docs,source:{originalSource:'props => {\n  const [data, setData] = React.useState((EMPTY_DATA as Matrix.Matrix<StringCell>));\n  const [filter, setFilter] = React.useState("");\n  const handleFilterChange = React.useCallback(event => {\n    const nextFilter = event.target.value;\n    setFilter(nextFilter);\n  }, [setFilter]);\n\n  /**\n   * Removes cells not matching the filter from matrix while maintaining the\n   * minimum size that includes all of the matching cells.\n   */\n  const filtered = React.useMemo(() => {\n    if (filter.length === 0) {\n      return data;\n    }\n    const filtered: Matrix.Matrix<StringCell> = [];\n    for (let row = 0; row < data.length; row++) {\n      if (data.length !== 0) {\n        for (let column = 0; column < data[0].length; column++) {\n          const cell = data[row][column];\n          if (cell && cell.value && cell.value.includes(filter)) {\n            if (!filtered[0]) {\n              filtered[0] = [];\n            }\n            if (filtered[0].length < column) {\n              filtered[0].length = column + 1;\n            }\n            if (!filtered[row]) {\n              filtered[row] = [];\n            }\n            filtered[row][column] = cell;\n          }\n        }\n      }\n    }\n    return filtered;\n  }, [data, filter]);\n  return <>\n      <div>\n        <input type="text" placeholder="Filter" value={filter} onChange={handleFilterChange} />\n      </div>\n      <Spreadsheet {...props} data={filtered} onChange={setData} />\n    </>;\n}',...Filter.parameters?.docs?.source}}};const __namedExportsOrder=["Basic","DarkMode","Controlled","CustomRowLabels","CustomColumnLabels","HideIndicators","Readonly","WithAsyncCellData","WithCustomCell","RangeCell","WithSelectCell","WithCornerIndicator","Filter"]},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!./src/Spreadsheet.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".Spreadsheet {\n  --background-color: white;\n  --text-color: black;\n  --readonly-text-color: rgba(0, 0, 0, 0.4);\n  --outline-color: #4285f4;\n  --outline-background-color: rgba(160, 195, 255, 0.2);\n  --border-color: hsl(2deg, 0%, 91%);\n  --header-background-color: rgba(0, 0, 0, 0.04);\n  --elevation: 0 2px 5px rgba(0, 0, 0, 0.4);\n\n  position: relative;\n  overflow: visible;\n  background: var(--background-color);\n  color: var(--text-color);\n  display: inline-block;\n}\n\n.Spreadsheet--dark-mode {\n  --background-color: black;\n  --text-color: white;\n  --readonly-text-color: rgba(255, 255, 255, 0.4);\n  --header-background-color: rgba(255, 255, 255, 0.04);\n  --border-color: hsl(2deg, 0%, 19%);\n}\n\n.Spreadsheet__active-cell {\n  position: absolute;\n  border: 2px solid var(--outline-color);\n  box-sizing: border-box;\n}\n\n.Spreadsheet__active-cell--edit {\n  background: var(--background-color);\n  box-shadow: var(--elevation);\n}\n\n.Spreadsheet__table {\n  border-collapse: collapse;\n  table-layout: fixed;\n}\n\n.Spreadsheet__cell,\n.Spreadsheet__active-cell {\n  cursor: cell;\n}\n\n.Spreadsheet__cell {\n  outline: none;\n}\n\n.Spreadsheet__cell--readonly {\n  color: var(--readonly-text-color);\n}\n\n.Spreadsheet__cell,\n.Spreadsheet__header {\n  min-width: 6em;\n  min-height: 1.9em;\n  height: 1.9em;\n  max-height: 1.9em;\n  border: 1px solid var(--border-color);\n  overflow: hidden;\n  word-break: keep-all;\n  white-space: nowrap;\n  text-align: left;\n  box-sizing: border-box;\n  user-select: none;\n}\n\n.Spreadsheet__header {\n  background: var(--header-background-color);\n  color: var(--readonly-text-color);\n  text-align: center;\n  font: inherit;\n}\n\n.Spreadsheet__header--selected {\n  background: #5f6268;\n  color: #fff;\n}\n\n.Spreadsheet__header,\n.Spreadsheet__data-viewer,\n.Spreadsheet__data-editor input {\n  padding: 4px;\n  box-sizing: border-box;\n}\n\n.Spreadsheet__data-editor,\n.Spreadsheet__data-editor input {\n  width: 100%;\n  height: 100%;\n}\n\n.Spreadsheet__data-editor input {\n  font: inherit;\n  color: inherit;\n  background: none;\n  border: none;\n  outline: none;\n  margin: 0;\n}\n\n.Spreadsheet__data-viewer--boolean {\n  text-align: center;\n}\n\n.Spreadsheet__floating-rect {\n  position: absolute;\n  pointer-events: none;\n  box-sizing: border-box;\n}\n\n.Spreadsheet__floating-rect--hidden {\n  display: none;\n}\n\n.Spreadsheet__floating-rect--selected {\n  background: var(--outline-background-color);\n  border: 2px var(--outline-color) solid;\n}\n\n.Spreadsheet__floating-rect--dragging {\n  border: none;\n}\n\n.Spreadsheet__floating-rect--copied {\n  border: 2px var(--outline-color) dashed;\n}\n","",{version:3,sources:["webpack://./src/Spreadsheet.css"],names:[],mappings:"AAAA;EACE,yBAAyB;EACzB,mBAAmB;EACnB,yCAAyC;EACzC,wBAAwB;EACxB,oDAAoD;EACpD,kCAAkC;EAClC,8CAA8C;EAC9C,yCAAyC;;EAEzC,kBAAkB;EAClB,iBAAiB;EACjB,mCAAmC;EACnC,wBAAwB;EACxB,qBAAqB;AACvB;;AAEA;EACE,yBAAyB;EACzB,mBAAmB;EACnB,+CAA+C;EAC/C,oDAAoD;EACpD,kCAAkC;AACpC;;AAEA;EACE,kBAAkB;EAClB,sCAAsC;EACtC,sBAAsB;AACxB;;AAEA;EACE,mCAAmC;EACnC,4BAA4B;AAC9B;;AAEA;EACE,yBAAyB;EACzB,mBAAmB;AACrB;;AAEA;;EAEE,YAAY;AACd;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,iCAAiC;AACnC;;AAEA;;EAEE,cAAc;EACd,iBAAiB;EACjB,aAAa;EACb,iBAAiB;EACjB,qCAAqC;EACrC,gBAAgB;EAChB,oBAAoB;EACpB,mBAAmB;EACnB,gBAAgB;EAChB,sBAAsB;EACtB,iBAAiB;AACnB;;AAEA;EACE,0CAA0C;EAC1C,iCAAiC;EACjC,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,mBAAmB;EACnB,WAAW;AACb;;AAEA;;;EAGE,YAAY;EACZ,sBAAsB;AACxB;;AAEA;;EAEE,WAAW;EACX,YAAY;AACd;;AAEA;EACE,aAAa;EACb,cAAc;EACd,gBAAgB;EAChB,YAAY;EACZ,aAAa;EACb,SAAS;AACX;;AAEA;EACE,kBAAkB;AACpB;;AAEA;EACE,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;AACxB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,2CAA2C;EAC3C,sCAAsC;AACxC;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,uCAAuC;AACzC",sourcesContent:[".Spreadsheet {\n  --background-color: white;\n  --text-color: black;\n  --readonly-text-color: rgba(0, 0, 0, 0.4);\n  --outline-color: #4285f4;\n  --outline-background-color: rgba(160, 195, 255, 0.2);\n  --border-color: hsl(2deg, 0%, 91%);\n  --header-background-color: rgba(0, 0, 0, 0.04);\n  --elevation: 0 2px 5px rgba(0, 0, 0, 0.4);\n\n  position: relative;\n  overflow: visible;\n  background: var(--background-color);\n  color: var(--text-color);\n  display: inline-block;\n}\n\n.Spreadsheet--dark-mode {\n  --background-color: black;\n  --text-color: white;\n  --readonly-text-color: rgba(255, 255, 255, 0.4);\n  --header-background-color: rgba(255, 255, 255, 0.04);\n  --border-color: hsl(2deg, 0%, 19%);\n}\n\n.Spreadsheet__active-cell {\n  position: absolute;\n  border: 2px solid var(--outline-color);\n  box-sizing: border-box;\n}\n\n.Spreadsheet__active-cell--edit {\n  background: var(--background-color);\n  box-shadow: var(--elevation);\n}\n\n.Spreadsheet__table {\n  border-collapse: collapse;\n  table-layout: fixed;\n}\n\n.Spreadsheet__cell,\n.Spreadsheet__active-cell {\n  cursor: cell;\n}\n\n.Spreadsheet__cell {\n  outline: none;\n}\n\n.Spreadsheet__cell--readonly {\n  color: var(--readonly-text-color);\n}\n\n.Spreadsheet__cell,\n.Spreadsheet__header {\n  min-width: 6em;\n  min-height: 1.9em;\n  height: 1.9em;\n  max-height: 1.9em;\n  border: 1px solid var(--border-color);\n  overflow: hidden;\n  word-break: keep-all;\n  white-space: nowrap;\n  text-align: left;\n  box-sizing: border-box;\n  user-select: none;\n}\n\n.Spreadsheet__header {\n  background: var(--header-background-color);\n  color: var(--readonly-text-color);\n  text-align: center;\n  font: inherit;\n}\n\n.Spreadsheet__header--selected {\n  background: #5f6268;\n  color: #fff;\n}\n\n.Spreadsheet__header,\n.Spreadsheet__data-viewer,\n.Spreadsheet__data-editor input {\n  padding: 4px;\n  box-sizing: border-box;\n}\n\n.Spreadsheet__data-editor,\n.Spreadsheet__data-editor input {\n  width: 100%;\n  height: 100%;\n}\n\n.Spreadsheet__data-editor input {\n  font: inherit;\n  color: inherit;\n  background: none;\n  border: none;\n  outline: none;\n  margin: 0;\n}\n\n.Spreadsheet__data-viewer--boolean {\n  text-align: center;\n}\n\n.Spreadsheet__floating-rect {\n  position: absolute;\n  pointer-events: none;\n  box-sizing: border-box;\n}\n\n.Spreadsheet__floating-rect--hidden {\n  display: none;\n}\n\n.Spreadsheet__floating-rect--selected {\n  background: var(--outline-background-color);\n  border: 2px var(--outline-color) solid;\n}\n\n.Spreadsheet__floating-rect--dragging {\n  border: none;\n}\n\n.Spreadsheet__floating-rect--copied {\n  border: 2px var(--outline-color) dashed;\n}\n"],sourceRoot:""}]);const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);